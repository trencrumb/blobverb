import "./chunk-5FUTL2UF.js";

// node_modules/wavesurfer.js/dist/plugins/timeline.esm.js
var t = class {
  constructor() {
    this.listeners = {};
  }
  on(t2, e2, i2) {
    if (this.listeners[t2] || (this.listeners[t2] = /* @__PURE__ */ new Set()), null == i2 ? void 0 : i2.once) {
      const i3 = (...s2) => {
        this.un(t2, i3), e2(...s2);
      };
      return this.listeners[t2].add(i3), () => this.un(t2, i3);
    }
    return this.listeners[t2].add(e2), () => this.un(t2, e2);
  }
  un(t2, e2) {
    var i2;
    null === (i2 = this.listeners[t2]) || void 0 === i2 || i2.delete(e2);
  }
  once(t2, e2) {
    return this.on(t2, e2, { once: true });
  }
  unAll() {
    this.listeners = {};
  }
  emit(t2, ...e2) {
    this.listeners[t2] && this.listeners[t2].forEach(((t3) => t3(...e2)));
  }
};
var e = class extends t {
  constructor(t2) {
    super(), this.subscriptions = [], this.isDestroyed = false, this.options = t2;
  }
  onInit() {
  }
  _init(t2) {
    this.isDestroyed && (this.subscriptions = [], this.isDestroyed = false), this.wavesurfer = t2, this.onInit();
  }
  destroy() {
    this.emit("destroy"), this.subscriptions.forEach(((t2) => t2())), this.subscriptions = [], this.isDestroyed = true, this.wavesurfer = void 0;
  }
};
function i(t2, e2) {
  const s2 = e2.xmlns ? document.createElementNS(e2.xmlns, t2) : document.createElement(t2);
  for (const [t3, n2] of Object.entries(e2)) if ("children" === t3 && n2) for (const [t4, e3] of Object.entries(n2)) e3 instanceof Node ? s2.appendChild(e3) : "string" == typeof e3 ? s2.appendChild(document.createTextNode(e3)) : s2.appendChild(i(t4, e3));
  else "style" === t3 ? Object.assign(s2.style, n2) : "textContent" === t3 ? s2.textContent = n2 : s2.setAttribute(t3, n2.toString());
  return s2;
}
function s(t2, e2, s2) {
  return i(t2, e2 || {});
}
var n = { height: 20, timeOffset: 0, formatTimeCallback: (t2) => {
  if (t2 / 60 > 1) {
    return `${Math.floor(t2 / 60)}:${`${(t2 = Math.round(t2 % 60)) < 10 ? "0" : ""}${t2}`}`;
  }
  return `${Math.round(1e3 * t2) / 1e3}`;
} };
var r = class _r extends e {
  constructor(t2) {
    super(t2 || {}), this.unsubscribeNotches = [], this.notchElements = /* @__PURE__ */ new Map(), this.options = Object.assign({}, n, t2), this.timelineWrapper = this.initTimelineWrapper();
  }
  static create(t2) {
    return new _r(t2);
  }
  onInit() {
    var t2;
    if (!this.wavesurfer) throw Error("WaveSurfer is not initialized");
    let e2 = this.wavesurfer.getWrapper();
    if (this.options.container instanceof HTMLElement) e2 = this.options.container;
    else if ("string" == typeof this.options.container) {
      const t3 = document.querySelector(this.options.container);
      if (!t3) throw Error(`No Timeline container found matching ${this.options.container}`);
      e2 = t3;
    }
    this.options.insertPosition ? (e2.firstElementChild || e2).insertAdjacentElement(this.options.insertPosition, this.timelineWrapper) : e2.appendChild(this.timelineWrapper), this.subscriptions.push(this.wavesurfer.on("redraw", (() => this.initTimeline()))), ((null === (t2 = this.wavesurfer) || void 0 === t2 ? void 0 : t2.getDuration()) || this.options.duration) && this.initTimeline();
  }
  destroy() {
    this.unsubscribeNotches.forEach(((t2) => t2())), this.unsubscribeNotches = [], this.timelineWrapper.remove(), super.destroy();
  }
  initTimelineWrapper() {
    return s("div", { part: "timeline-wrapper", style: { pointerEvents: "none" } });
  }
  defaultTimeInterval(t2) {
    return t2 >= 25 ? 1 : 5 * t2 >= 25 ? 5 : 15 * t2 >= 25 ? 15 : 60 * Math.ceil(0.5 / t2);
  }
  defaultPrimaryLabelInterval(t2) {
    return t2 >= 25 ? 10 : 5 * t2 >= 25 ? 6 : 4;
  }
  defaultSecondaryLabelInterval(t2) {
    return t2 >= 25 ? 5 : 2;
  }
  virtualAppend(t2, e2, i2) {
    if (this.notchElements.set(i2, { start: t2, width: i2.clientWidth, wasVisible: false }), !this.wavesurfer) return;
    const s2 = this.wavesurfer.getScroll(), n2 = s2 + this.wavesurfer.getWidth(), r2 = this.notchElements.get(i2), o = t2 >= s2 && t2 + r2.width < n2;
    r2.wasVisible = o, o && e2.appendChild(i2);
  }
  updateVisibleNotches(t2, e2, i2) {
    this.notchElements.forEach(((s2, n2) => {
      const r2 = s2.start >= t2 && s2.start + s2.width < e2;
      r2 !== s2.wasVisible && (s2.wasVisible = r2, r2 ? i2.appendChild(n2) : n2.remove());
    }));
  }
  initTimeline() {
    var t2, e2, i2, n2, r2, o, l, h;
    this.unsubscribeNotches.forEach(((t3) => t3())), this.unsubscribeNotches = [], this.notchElements.clear();
    const a = null !== (i2 = null !== (e2 = null === (t2 = this.wavesurfer) || void 0 === t2 ? void 0 : t2.getDuration()) && void 0 !== e2 ? e2 : this.options.duration) && void 0 !== i2 ? i2 : 0, c = ((null === (n2 = this.wavesurfer) || void 0 === n2 ? void 0 : n2.getWrapper().scrollWidth) || this.timelineWrapper.scrollWidth) / a, p = null !== (r2 = this.options.timeInterval) && void 0 !== r2 ? r2 : this.defaultTimeInterval(c), u = null !== (o = this.options.primaryLabelInterval) && void 0 !== o ? o : this.defaultPrimaryLabelInterval(c), d = this.options.primaryLabelSpacing, f = null !== (l = this.options.secondaryLabelInterval) && void 0 !== l ? l : this.defaultSecondaryLabelInterval(c), m = this.options.secondaryLabelSpacing, b = "beforebegin" === this.options.insertPosition, v = s("div", { style: Object.assign({ height: `${this.options.height}px`, overflow: "hidden", fontSize: this.options.height / 2 + "px", whiteSpace: "nowrap" }, b ? { position: "absolute", top: "0", left: "0", right: "0", zIndex: "2" } : { position: "relative" }) });
    v.setAttribute("part", "timeline"), "string" == typeof this.options.style ? v.setAttribute("style", v.getAttribute("style") + this.options.style) : "object" == typeof this.options.style && Object.assign(v.style, this.options.style);
    const y = s("div", { style: { width: "0", height: "50%", display: "flex", flexDirection: "column", justifyContent: b ? "flex-start" : "flex-end", top: b ? "0" : "auto", bottom: b ? "auto" : "0", overflow: "visible", borderLeft: "1px solid currentColor", opacity: `${null !== (h = this.options.secondaryLabelOpacity) && void 0 !== h ? h : 0.25}`, position: "absolute", zIndex: "1" } });
    for (let t3 = 0, e3 = 0; t3 < a; t3 += p, e3++) {
      const i3 = y.cloneNode(), s2 = Math.round(100 * t3) % Math.round(100 * u) == 0 || d && e3 % d == 0, n3 = Math.round(100 * t3) % Math.round(100 * f) == 0 || m && e3 % m == 0;
      (s2 || n3) && (i3.style.height = "100%", i3.style.textIndent = "3px", i3.textContent = this.options.formatTimeCallback(t3), s2 && (i3.style.opacity = "1"));
      const r3 = s2 ? "primary" : n3 ? "secondary" : "tick";
      i3.setAttribute("part", `timeline-notch timeline-notch-${r3}`);
      const o2 = Math.round(100 * (t3 + this.options.timeOffset)) / 100 * c;
      i3.style.left = `${o2}px`, this.virtualAppend(o2, v, i3);
    }
    this.timelineWrapper.innerHTML = "", this.timelineWrapper.appendChild(v), this.wavesurfer && this.unsubscribeNotches.push(this.wavesurfer.on("scroll", ((t3, e3, i3, s2) => {
      this.updateVisibleNotches(i3, s2, v);
    }))), this.emit("ready");
  }
};
export {
  r as default
};
//# sourceMappingURL=wavesurfer__js_dist_plugins_timeline__esm__js.js.map
