<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlobVerb</title>
    <link rel="icon" href="/src/favicon_io/favicon.ico">
    <link rel="stylesheet" href="/src/styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/src/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/src/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/src/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="/src/favicon_io/site.webmanifest">
</head>
<body>
    <div id="splashScreen">
        <div class="splash-content">
            <h1>BlobVerb</h1>
            <p>Press start to unlock audio</p>
            <button id="enterAppBtn" class="cta">Enter</button>
        </div>
    </div>
    <div class="app-layout">
        <div class="top-row">
            <div id="scenePanel" class="panel scene-panel">
                <div id="threeViewport" class="scene-viewport"></div>
            </div>

            <div id="controlPanel" class="panel">
                <section class="panel-section is-open" data-section="about">
                    <button class="section-toggle" type="button" aria-expanded="true">
                        <span>About</span>
                        <span class="toggle-icon" aria-hidden="true"></span>
                    </button>
                    <div class="section-body">
                        <p>BlobVerb is an experimental web-based audio ray tracing simulator and auralizer. It uses procedural geometry and simulates the acoustic response of a room to generate impulse responses (IRs) that can be used for convolution reverb.</p>
                        <p>This project is a work in progress by <a href="https://kyle-ramsey.com" target="_blank" rel="noopener">Kyle Ramsey</a>. The source code is available on <a href="https://github.com/kyle-ramsey/blobverb" target="_blank" rel="noopener">GitHub</a>.</p>
                    </div>
                </section>
                <section class="panel-section" data-section="instructions">
                    <button class="section-toggle" type="button" aria-expanded="false">
                        <span>Instructions</span>
                        <span class="toggle-icon" aria-hidden="true"></span>
                    </button>
                    <div class="section-body">
                        <ol>
                            <li>Adjust the simulation parameters to define the room shape and acoustic properties.</li>
                            <li>Click "Simulate Acoustics" to run the ray tracing simulation. This may take a few moments.</li>
                            <li>Once the simulation is complete, you can play sample audio or upload your own dry audio file to hear it convolved with the generated impulse response.</li>
                            <li>You can also download the generated impulse response as a .wav file for use in other audio software.</li>
                        </ol>
                        <p>Note: For best performance, use a modern browser that supports Web Audio and WebGL.</p>
                    </div>

                </section>
                <section class="panel-section is-open" data-section="simulation">
                    <button class="section-toggle" type="button" aria-expanded="true">
                        <span>Simulation Controls</span>
                        <span class="toggle-icon" aria-hidden="true"></span>
                    </button>
                    <div class="section-body">
                        <fieldset>
                            <legend>Core Properties</legend>
                            <div class="control-group">
                                <label for="randomSeed">Simulation Seed</label>
                                <div class="flex-row">
                                    <input type="text" id="randomSeed" value="nmz6kp.6n">
                                    <button id="randomizeSeedBtn" title="Generate Random Seed">ðŸŽ²</button>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend>Visualization</legend>
                            <div class="control-group">
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend>Procedural Shape</legend>
                            <div class="control-group">
                                <label for="baseRadius">Radius <span id="baseRadius-val">15</span> m</label>
                                <input type="range" id="baseRadius" min="5" max="30" step="1" value="15">
                            </div>
                            <div class="control-group">
                                <label for="noiseFreq">Noise Freq <span id="noiseFreq-val">0.2</span></label>
                                <input type="range" id="noiseFreq" min="0.05" max="1.0" step="0.01" value="0.2">
                            </div>
                            <div class="control-group">
                                <label for="noiseAmp">Noise Amp <span id="noiseAmp-val">5</span> m</label>
                                <input type="range" id="noiseAmp" min="0" max="10" step="0.1" value="5">
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend>Acoustic Properties</legend>
                            <div class="control-group">
                                <label for="numRays">Number of Rays <span id="numRays-val">15000</span></label>
                                <input type="range" id="numRays" min="1" max="30000" step="10" value="15000">
                            </div>
                            <div id="freq-absorption-controls" class="control-group">
                                <label>200 Hz: <span id="absorption200-val">0.15</span><input type="range" id="absorption200" min="0.01" max="1" step="0.01" value="0.15" /></label>
                                <label>800 Hz: <span id="absorption800-val">0.2</span><input type="range" id="absorption800" min="0.01" max="1" step="0.01" value="0.2" /></label>
                                <label>3200 Hz: <span id="absorption3200-val">0.25</span><input type="range" id="absorption3200" min="0.01" max="1" step="0.01" value="0.25" /></label>
                                <label>10000 Hz: <span id="absorption10000-val">0.3</span><input type="range" id="absorption10000" min="0.01" max="1" step="0.01" value="0.3" /></label>
                            </div>
                            <div class="control-group">
                                <label>
                                    <input type="checkbox" id="useWebWorker" checked />
                                    Use Web Worker
                                </label>
                            </div>
                            <div class="control-group">
                                <label>
                                    <input type="checkbox" id="realtimeSimToggle" checked/>
                                    Realtime Preview (1500 rays)
                                </label>
                            </div>

                            <script>
                            // Show/hide frequency controls based on checkbox
                            document.getElementById('useFreqDependent')?.addEventListener('change', (e) => {
                                document.getElementById('freq-absorption-controls').style.display = e.target.checked ? 'block' : 'none';
                            });
                            </script>
                        </fieldset>

                        <button id="startButton" class="cta">Simulate Acoustics</button>
                    </div>
                </section>
            </div>
        </div>

        <section id="auralizationPanel" class="panel-section is-open auralization-panel" data-section="auralization">
            <div class="section-header">
                <span>Controls</span>
            </div>
            <div class="section-body">
                <div class="auralization-grid">
                    <div class="auralization-card controls-column">
                        <fieldset>
                            <legend>Default Samples</legend>
                            <label for="sample-audio">Select Sample</label>
                            <div class="control-inline">
                                <select name="sample-audio" id="sample-audio">
                                    <option value="dog">Dog Bark (demo)</option>
                                    <option value="synth">Synth Pad</option>
                                    <option value="drum">Drum Hit</option>
                                    <option value="vocal">Vocal Phrase</option>
                                </select>
                                <button id="playSampleBtn" type="button">Play</button>
                            </div>
                            <div class="control-group">
                                <span>Dry Level</span>
                                <output for="dry-slider" id="dry-output">0.0 dB</output>
                                <input type="range" id="dry-slider" min="0" max="1000" step="1">
                            </div>

                            <div class="control-group">
                                <span>Wet Level</span>
                                <output for="wet-slider" id="wet-output">0.0 dB</output>
                                <input type="range" id="wet-slider" min="0" max="1000" step="1">
                            </div>
                        </fieldset>
                    </div>
                    <div class="auralization-card eq-column">
                        <weq8-ui />
                    </div>
                    <div class="auralization-card waveform-column">
                        <div id="waveform"></div>
                        <button id="downloadBtn" type="button" disabled>Download IR (.wav)</button>
                    </div>
                </div>
                <div class="auralization-status">
                    <span>Console: </span>
                    <p id="status" class="status-text">Simulate an IR to begin.</p>
                </div>
            </div>
        </section>
    </div>

    <script type="module" src="/src/main.js"></script>
</body>
</html>